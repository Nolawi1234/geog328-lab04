<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>US population density</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

  <!-- Mapbox GL CSS -->
  <link
    href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css"
    rel="stylesheet"
  />

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    .info-card {
      position: absolute;
      top: 16px;
      left: 16px;
      background: white;
      padding: 12px 16px;
      border-radius: 4px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.15);
      max-width: 260px;
      z-index: 1;
    }

    .info-card h2 {
      margin: 0 0 4px 0;
      font-size: 16px;
    }

    .info-card p {
      margin: 0;
      font-size: 13px;
    }

    /* Legend styles */
    .legend {
      position: absolute;
      bottom: 16px;
      left: 16px;
      background: white;
      padding: 8px 10px;
      border-radius: 4px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.15);
      font-size: 11px;
      line-height: 1.4;
    }

    .legend-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-top: 2px;
    }

    .legend-color {
      width: 14px;
      height: 14px;
      margin-right: 6px;
      border-radius: 2px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="info-card" id="info">
    <h2>US population density</h2>
    <p>Hover over a state!</p>
  </div>

  <!-- Legend box -->
  <div id="legend" class="legend"></div>

  <!-- Mapbox GL JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script>
    // ðŸ”‘ YOUR MAPBOX TOKEN
    mapboxgl.accessToken = "pk.eyJ1Ijoibm9sYXdpMjQiLCJhIjoiY21obW8yZWE5MmN2cjJscTE1am1sZnVmMiJ9.zLy0Qd4BNKLtusNXQYxWjw";

    const map = new mapboxgl.Map({
      container: "map",
      style: "mapbox://styles/mapbox/light-v11",
      center: [-98, 38.5], // center of US
      zoom: 3.2,
    });

    map.on("load", () => {
      // Load state polygons from the assets folder
      map.addSource("states", {
        type: "geojson",
        data: "assets/state_data.geojson",
      });

      // Choropleth fill layer based on population density
      map.addLayer({
        id: "state-fills",
        type: "fill",
        source: "states",
        paint: {
          "fill-color": [
            "interpolate",
            ["linear"],
            ["get", "density"], // assumes property is called "density"
            0,
            "#f2f0f7",
            10,
            "#cbc9e2",
            50,
            "#9e9ac8",
            100,
            "#756bb1",
            200,
            "#54278f",
          ],
          "fill-opacity": 0.75,
        },
      });

      // State borders
      map.addLayer({
        id: "state-borders",
        type: "line",
        source: "states",
        paint: {
          "line-color": "#ffffff",
          "line-width": 0.5,
        },
      });

      const info = document.getElementById("info");
      const legend = document.getElementById("legend");

      // Build legend to match the color ramp
      legend.innerHTML = `
        <div class="legend-title">Density (people / sq. mile)</div>
      `;

      const layers = ["0â€“10", "10â€“50", "50â€“100", "100â€“200", "200+"];
      const colors = ["#f2f0f7", "#cbc9e2", "#9e9ac8", "#756bb1", "#54278f"];

      layers.forEach((layer, i) => {
        const item = document.createElement("div");
        item.className = "legend-item";
        item.innerHTML = `
          <span class="legend-color" style="background:${colors[i]}"></span>
          <span>${layer}</span>
        `;
        legend.appendChild(item);
      });

      // Hover interaction
      map.on("mousemove", "state-fills", (e) => {
        const feature = e.features[0];
        const name = feature.properties.name || feature.properties.STATE_NAME;
        const density =
          feature.properties.density ||
          feature.properties.DENSITY ||
          feature.properties.pop_density;

        info.innerHTML = `
          <h2>US population density</h2>
          <p><strong>${name || "Unknown state"}</strong><br>
          Density: ${density !== undefined ? density : "N/A"}</p>
        `;
      });

      map.on("mouseleave", "state-fills", () => {
        info.innerHTML = `
          <h2>US population density</h2>
          <p>Hover over a state!</p>
        `;
      });
    });
  </script>
</body>
</html>
